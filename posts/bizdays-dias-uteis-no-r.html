<!DOCTYPE html>
<html lang="pt">
<head>
	<meta charset="utf-8">
	<title>bizdays—dias úteis no R — Wilson Freitas</title>
	<link rel="shortcut icon" href="http://wilsonfreitas.github.io/images/favicon.ico">
	<meta name="description" content="Title: bizdays—dias úteis no R; Date: 2014-05-15; Author: Wilson Freitas">
	<meta name="author" content="Wilson Freitas">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="http://wilsonfreitas.github.io/theme/html5.js"></script>
		<![endif]-->
	<!-- <link href="http://wilsonfreitas.github.io/theme/css/ipython.css" rel="stylesheet"> -->
	<link href="http://wilsonfreitas.github.io/theme/css/font-awesome.min.css" rel="stylesheet">
	<link href="http://wilsonfreitas.github.io/theme/css/bootstrap.min.css" rel="stylesheet">
	<link href="http://wilsonfreitas.github.io/theme/css/local.css" rel="stylesheet">
	<link href="http://wilsonfreitas.github.io/theme/css/pygments.css" rel="stylesheet">
	<script type="text/x-mathjax-config">
	MathJax.Hub.Config({
		tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
	});
	</script>
	<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	<meta property="twitter:card" content="summary" />
	<meta property="twitter:site" content="@aboutwilson" />
	<meta property="twitter:title" content="bizdays—dias úteis no R"/>
	<meta property="twitter:description" content=""/>
	<meta property="twitter:image" content=""/>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-4510606-3', 'auto');
  ga('send', 'pageview');

</script>
</head>
<body>
<div class="container">
	<nav class="navbar navbar-default" style="margin-top:2em;">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="http://wilsonfreitas.github.io/index.html">Wilson Freitas</a>
			</div>
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li><a href="http://wilsonfreitas.github.io/index.html"><i class="fa fa-home"></i> Home</a></li>
					<li><a href="http://wilsonfreitas.github.io/archives.html"><i class="fa fa-archive "></i> Arquivo</a></li>
					<li><a href="http://wilsonfreitas.github.io/pages/about.html"><i class="fa fa-user "></i> Sobre</a></li>
					<li><a href="http://wilsonfreitas.github.io/pages/projects.html"><i class="fa fa-code "></i> Projetos</a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li><a href="http://wilsonfreitas.github.io/categories.html"><i class="fa fa-archive"></i> Categorias</a></li>
					<li><a href="http://wilsonfreitas.github.io/tags.html"><i class="fa fa-tags"></i> Tags</a></li>
					<li><a href="http://wilsonfreitas.github.io/feeds/rss.xml"><i class="fa fa-rss"></i> RSS</a></li>
				</ul>
			</div>
		</div>
	</nav>
	<div class="row">
		<div class="col-md-12">
<div class="article" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="text-center article-header">
		<h1 itemprop="name headline" class="article-title">bizdays—dias úteis no R</h1>
		<span itemprop="author" itemscope itemtype="http://schema.org/Person">
			<h4 itemprop="name">Wilson Freitas</h4>
		</span>
		<time datetime="2014-05-15T00:00:00-03:00" itemprop="datePublished">15/05/2014</time>
	</div>
	<div>
		Categoria:
		<span itemprop="articleSection">
			<a href="http://wilsonfreitas.github.io/category/finance.html" rel="category">finance</a>
		</span>
	</div>
 
	<div>
		Tags:
		<span itemprop="keywords">
			<a href="http://wilsonfreitas.github.io/tag/r.html" rel="tag">R</a>
		</span>
		<span itemprop="keywords">
			<a href="http://wilsonfreitas.github.io/tag/bizdays.html" rel="tag">bizdays</a>
		</span>
		<span itemprop="keywords">
			<a href="http://wilsonfreitas.github.io/tag/dias-uteis.html" rel="tag">dias úteis</a>
		</span>
		<span itemprop="keywords">
			<a href="http://wilsonfreitas.github.io/tag/calendario.html" rel="tag">calendário</a>
		</span>
	</div>
	<div itemprop="articleBody" class="article-body"><p>Quem trabalha no mercado financeiro brasileiro lida constantemente com uma praga que é a contagem de dias úteis.
Não que seja difícil utilizar a contagem de dias úteis para fazer o apreçamento de instrumentos financeiros.
A dificuldade é ter a contagem de dias úteis a mão e de maneira flexível, onde possamos, eventualmente, inserir ou remover feriados.
Essa disponibilidade é a razão pela qual o Excel é tão utilizado.
Basta carregar uma lista de feriados, que hoje são disponibilizados no site da <a href="http://www.anbima.com.br" title="ANBIMA">ANBIMA</a> e são suficientes para a maioria dos instrumentos negociados no mercado brasileiro, e chamar a função <code>NETWORKDAYS</code> para calcular a quantidade de dias úteis entre duas datas de acordo com a lista de feriados.
Há ainda a função <code>WORKDAYS</code> que retorna uma data somando ou subtraindo uma quantidade de dias úteis a outra data, só que considerando uma lista de feriados.</p>
<p>Para levar essa disponibilidade ao R eu desenvolvi o pacote <a href="https://github.com/wilsonfreitas/R-bizdays" title="bizdays package"><code>bizdays</code></a>.
<code>bizdays</code> é uma pacote ridículo de simples mas que torna a minha vida muito, mas muito menos miserável, quando eu tenho que lidar com contagem de dias.
Tenho utilizado este pacote quase que diariamente no meu trabalho.
Nas próximas seções vou explicar como utilizar as funções e as idéias por trás do pacote.</p>
<h2>Instalação</h2>
<p>O <code>bizdays</code> pode ser instalado das 3 formas a seguir.</p>
<h4>CRAN</h4>
<div class="highlight"><pre><span></span>install.packages<span class="p">(</span><span class="s">&#39;bizdays&#39;</span><span class="p">)</span>
</pre></div>


<h4>Github + devtools</h4>
<div class="highlight"><pre><span></span>devtools<span class="o">::</span>install_github<span class="p">(</span><span class="s">&#39;R-bizdays&#39;</span><span class="p">,</span> <span class="s">&#39;wilsonfreitas&#39;</span><span class="p">)</span>
</pre></div>


<h4>Task view finance</h4>
<p>Instalando a <em>task view Finance</em> o <code>bizdays</code> vem junto no pacote.</p>
<div class="highlight"><pre><span></span><span class="kn">library</span><span class="p">(</span><span class="s">&quot;ctv&quot;</span><span class="p">)</span>
install.views<span class="p">(</span><span class="s">&quot;Finance&quot;</span><span class="p">)</span>
</pre></div>


<h2>Usando bizdays</h2>
<h3>Criação do calendário</h3>
<p>Toda a idéia do <code>bizdays</code> está ao redor da criação do calendário e um calendário é basicamente uma lista de feriados.
Eu disponibilizo junto com <code>bizdays</code> o <em>dataset</em> <code>holidaysANBIMA</code> que já vem com a lista de feriados disponibilizada pela <a href="http://www.anbima.com.br" title="ANBIMA">ANBIMA</a>.</p>
<div class="highlight"><pre><span></span>data<span class="p">(</span>holidaysANBIMA<span class="p">,</span> package <span class="o">=</span> <span class="s">&#39;bizdays&#39;</span><span class="p">)</span>
<span class="kp">range</span><span class="p">(</span>holidaysANBIMA<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>## [1] &quot;2001-01-01&quot; &quot;2079-01-01&quot;
</pre></div>


<div class="highlight"><pre><span></span><span class="kp">length</span><span class="p">(</span>holidaysANBIMA<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>## [1] 937
</pre></div>


<p>Dada a lista de feriados basta executar a função <code>Calendar</code> passando a lista como argumento, mas antes vamos dar uma olhada na função <code>Calendar</code>.
A função <code>Calendar</code> tem os seguintes argumentos:</p>
<div class="highlight"><pre><span></span><span class="kp">args</span><span class="p">(</span>Calendar<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>## function (holidays = integer(0), start.date = NULL, end.date = NULL, 
##     name = NULL, weekdays = NULL, adjust.from = adjust.next, 
##     adjust.to = adjust.previous) 
## NULL
</pre></div>


<p>O argumento <code>weekdays</code> define os dias não úteis da semana, em um calendário de dias úteis temos <code>weekdays=c("saturday", "sunday")</code> representando os fins de semana.
Os argumentos <code>start.date</code> e <code>end.date</code> definem os limites do calendário, no entanto, estes argumentos são utilizados apenas quando a lista de <code>holidays</code> não é fornecida, pois, quando a lista é fornecida os limites são baseados nela.
O argumento <code>dib</code> define a quantidade de dias por ano no calendário, essa configuração visa extender a utilização do calendário para a utilização de <a href="http://en.wikipedia.org/wiki/Day_count_convention">convenções de contagem de dias</a>.
Vou comentar mais sobre a utilização do argumento <code>dib</code> mais adiante.
Os argumentos <code>adjust.from</code> e <code>adjust.to</code> recebem funções para ajustar as datas <code>from</code> e <code>to</code> utilizadas na função <code>bizdays</code>.
A configuração padrão visa reproduzir a função <code>NETWORKDAYS</code> do Excel.
O argumento <code>name</code> é apenas descritivo, mas eu gosto de utilizar pois é útil quando temos diferentes calendários.</p>
<p>Vamos agora criar um calendário referente aos feriados brasileiros.</p>
<div class="highlight"><pre><span></span><span class="p">(</span>cal <span class="o">&lt;-</span> Calendar<span class="p">(</span>holidaysANBIMA<span class="p">,</span> weekdays<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;saturday&#39;</span><span class="p">,</span> <span class="s">&#39;sunday&#39;</span><span class="p">),</span> name<span class="o">=</span><span class="s">&#39;ANBIMA&#39;</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span>## Calendar: ANBIMA 
## Range: 2001-01-01 to 2079-01-01 
## weekdays: saturday sunday
</pre></div>


<p>Note que os limites do calendário foram criados com base nos limites existentes na lista de feriados.</p>
<h3>Contando dias úteis entre datas</h3>
<p>Para calcular a quantidade de dias entre duas datas utilizamos a função <code>bizdays</code> passando o calendário e as datas iniciais e finais.</p>
<div class="highlight"><pre><span></span><span class="kp">args</span><span class="p">(</span>bizdays<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>## function (from, to, cal) 
## NULL
</pre></div>


<div class="highlight"><pre><span></span>bizdays<span class="p">(</span><span class="s">&#39;2013-01-01&#39;</span><span class="p">,</span> <span class="s">&#39;2013-12-31&#39;</span><span class="p">,</span> cal<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>## [1] 252
</pre></div>


<p>Essa função aceita datas em strings no formato ISO (<code>yyyy-mm-dd</code>) ou objetos <code>Date</code>, <code>POSIXct</code> e <code>POSIXlt</code>.
Os argumentos de datas finais e iniciais também aceitam vetores.
Os vetores podem ter tamanhos diferentes, desde que respeitem a <em>recicle rule</em> do R.</p>
<div class="highlight"><pre><span></span>bizdays<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;2010-01-01&#39;</span><span class="p">,</span> <span class="s">&#39;2011-01-01&#39;</span><span class="p">),</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;2011-12-31&#39;</span><span class="p">,</span> <span class="s">&#39;2012-12-31&#39;</span><span class="p">,</span> <span class="s">&#39;2013-12-31&#39;</span><span class="p">,</span> <span class="s">&#39;2014-12-31&#39;</span><span class="p">),</span> cal<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>## [1]  501  501 1005 1007
</pre></div>


<div class="highlight"><pre><span></span>bizdays<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;2008-01-01&#39;</span><span class="p">,</span> <span class="s">&#39;2009-01-01&#39;</span><span class="p">,</span> <span class="s">&#39;2010-01-01&#39;</span><span class="p">,</span> <span class="s">&#39;2011-01-01&#39;</span><span class="p">),</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;2011-12-31&#39;</span><span class="p">,</span> <span class="s">&#39;2012-12-31&#39;</span><span class="p">),</span> cal<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>## [1] 1005 1002  501  501
</pre></div>


<h3>Verificando se datas são dias úteis</h3>
<p>A função <code>is.bizday</code> verifica se as datas passadas no argumento são úteis.</p>
<div class="highlight"><pre><span></span>dates <span class="o">&lt;-</span> <span class="kp">as.Date</span><span class="p">(</span><span class="s">&#39;2014-04-14&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="m">0</span><span class="o">:</span><span class="m">6</span>
is.bizday<span class="p">(</span>dates<span class="p">,</span> cal<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>## [1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE
</pre></div>


<h3>Adicionando dias úteis as datas</h3>
<p>Para somar dias úteis a uma data utilizamos a função <code>add.bizdays</code> que soma dias úteis, positivos ou negativos, as datas fornecidas.</p>
<div class="highlight"><pre><span></span>date <span class="o">&lt;-</span> <span class="s">&#39;2014-04-14&#39;</span> <span class="c1"># segunda-feira</span>
add.bizdays<span class="p">(</span><span class="kp">date</span><span class="p">,</span> <span class="m">-1</span><span class="p">,</span> cal<span class="p">)</span>   <span class="c1"># sexta-feira</span>
</pre></div>


<div class="highlight"><pre><span></span>## [1] &quot;2014-04-11&quot;
</pre></div>


<h3>Gerando sequência de dias úteis</h3>
<p>Muitas vezes é necessário iterar sobre sequências de dias úteis e para isso temos a função <code>bizseq</code>.</p>
<div class="highlight"><pre><span></span>bizseq<span class="p">(</span><span class="s">&#39;2013-07-09&#39;</span><span class="p">,</span> <span class="s">&#39;2013-07-21&#39;</span><span class="p">,</span> cal<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>## [1] &quot;2013-07-09&quot; &quot;2013-07-10&quot; &quot;2013-07-11&quot; &quot;2013-07-12&quot; &quot;2013-07-15&quot;
## [6] &quot;2013-07-16&quot; &quot;2013-07-17&quot; &quot;2013-07-18&quot; &quot;2013-07-19&quot;
</pre></div>


<p>Todos as datas dessa sequência são dias úteis.</p>
<h3>Ajustando datas</h3>
<p>Uma coisa muito comum para quem trabalha com dias úteis é o ajuste de data quando cai em dia não útil.
Por exemplo, para apreçar títulos, quando vencimento do título cai em um dia não útil é necessário mover o fluxo para o próximo dia útil.
Para lidar com isso de forma higiênica temos as funções <code>adjust.next</code> e <code>adjust.previous</code>.
Estas funções recebem uma data, se for dia útil retorna a própria data, caso contrário retorna o dia útil seguinte ou anterior, dependendo da função que foi chamada.</p>
<div class="highlight"><pre><span></span>adjust.next<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;2014-01-01&quot;</span><span class="p">,</span> <span class="s">&quot;2014-02-01&quot;</span><span class="p">,</span> <span class="s">&quot;2014-03-01&quot;</span><span class="p">,</span> <span class="s">&quot;2014-04-01&quot;</span><span class="p">),</span> cal<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>## [1] &quot;2014-01-02&quot; &quot;2014-02-03&quot; &quot;2014-03-05&quot; &quot;2014-04-01&quot;
</pre></div>


<p>Logo, estas funções apenas ajustam as datas fornecidas quando é necessário.</p>
<h3>Configurando o calendário padrão</h3>
<p>Como eu falei eu uso <code>bizdays</code> em base diária e todos os dias o mesmo calendário, o calendário divulgado pela ANBIMA.
Uma coisa insuportável é criar o mesmo calendário toda vez que eu vou utilizar as funções.
Como o objetivo é reduzir a quantidade de miséria na minha vida eu criei o calendário padrão.</p>
<div class="highlight"><pre><span></span>bizdays.options<span class="o">$</span>set<span class="p">(</span>default.calendar<span class="o">=</span>cal<span class="p">)</span>
</pre></div>


<p>Uma vez definido um calendário padrão não é mais necessário passar o calendário como argumento das funções vistas anteriormente.
Dessa maneira, as funções podem ser chamadas como:</p>
<div class="highlight"><pre><span></span>bizdays<span class="p">(</span><span class="s">&#39;2013-01-01&#39;</span><span class="p">,</span> <span class="s">&#39;2013-12-31&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>## [1] 252
</pre></div>


<div class="highlight"><pre><span></span>dates <span class="o">&lt;-</span> <span class="kp">as.Date</span><span class="p">(</span><span class="s">&#39;2014-04-14&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="m">0</span><span class="o">:</span><span class="m">6</span>
is.bizday<span class="p">(</span>dates<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>## [1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE
</pre></div>


<div class="highlight"><pre><span></span>adjust.next<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;2014-01-01&quot;</span><span class="p">,</span> <span class="s">&quot;2014-02-01&quot;</span><span class="p">,</span> <span class="s">&quot;2014-03-01&quot;</span><span class="p">,</span> <span class="s">&quot;2014-04-01&quot;</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span>## [1] &quot;2014-01-02&quot; &quot;2014-02-03&quot; &quot;2014-03-05&quot; &quot;2014-04-01&quot;
</pre></div>


<p>Sem a necessidade de passar o calendário como parâmetro.
Para tornar as coisa realmente simples eu coloco essa definição no <code>.Rprofile</code>.</p>
<div class="highlight"><pre><span></span><span class="m">.</span>First <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kn">library</span><span class="p">(</span>bizdays<span class="p">)</span>
    cal <span class="o">&lt;-</span> Calendar<span class="p">(</span>holidays<span class="o">=</span>holidaysANBIMA<span class="p">,</span> name<span class="o">=</span><span class="s">&#39;ANBIMA&#39;</span><span class="p">)</span>
    bizdays.options<span class="o">$</span>set<span class="p">(</span>default.calendar<span class="o">=</span>cal<span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>Assim, toda vez que eu inicializo o R já tenho as funções do <code>bizdays</code> prontas pra utilizar.</p>
<h3>Demais funções</h3>
<ul>
<li><code>bizyears</code>: retorno o prazo em anos referente a quantidade de dias úteis. Essa função é útil para o apreçamento de instrumentos financeiros onde usualmente as taxas são expressas com periodicidade anual. Dessa maneira, uma vez definido o calendário para a taxa é possível obter o prazo em anos para os cálculos. Por isso é útil a definição do argumento <code>dib</code>.</li>
<li><code>bizdayse</code> e <code>bizyearse</code>: <code>bizdayse</code> retorna a quantidade de dias úteis equivalente a uma quantidade de dias corridos. É equivalente a somar dias úteis a uma data e calcular os dias úteis entre as duas data utilizando <code>bizdays</code>. A função <code>bizyearse</code> é a sua versão anualizada.</li>
</ul>
<h2>Conclusão</h2>
<p>O pacote <code>bizdays</code> visa a contagem de dias para o apreçamento de instrumentos financeiros de forma simples e intuitíva de utilizar, trazendo para o R a mesma simplicidade encontrada no Excel.
É útil tanto para calendários de dias úteis quanto dias corridos, permitindo a realização destes cálculos através de uma mesma interface.</p></div>
	<hr>
	<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'aboutwilson'; 
    var disqus_title = 'bizdays—dias úteis no R';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
		</div>
	</div>
</div>
<div class="container">
	<div class="row">
		<div class="col-md-12 text-center center-block aw-bottom">
			<p>&copy; Wilson Freitas 2015</p>
			<p>Powered by Pelican</p>
		</div>
	</div>
</div>
<!-- JavaScript -->
<script src="http://wilsonfreitas.github.io/theme/js/jquery-2.1.1.min.js"></script>
<script src="http://wilsonfreitas.github.io/theme/js/bootstrap.min.js"></script>
<script type="text/javascript">
$(document).ready(function($) {
	$("div.collapseheader").click(function () {
		$header = $(this).children("span").first();
		$codearea = $(this).children(".input_area");
		$codearea.slideToggle(500, function () {
			$header.text(function () {
				return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
			});
		});
	});
});
</script>
 
</body>
</html>